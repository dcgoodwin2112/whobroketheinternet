---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const { Content } = await post.render();

function formatDate(date: Date) {
  return new Date(date).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}
---

<BaseLayout title={`${post.data.title} - Who Broke The Internet?`} description={post.data.excerpt}>
  <article class="pb-12">
    <header class="mb-12 mx-auto">
      <a href="/" class="inline-block mb-8">
        ← Back to all posts
      </a>
      <h1 class="text-4xl md:text-5xl mb-6 leading-tight">{post.data.title}</h1>
      {post.data.cover && (
        <Image
          src={post.data.cover}
          alt={post.data.coverAlt || post.data.title}
          class="cover-image mb-6"
          loading="eager"
        />
      )}
      <div class="flex items-center gap-4 text-sm pb-6 border-b border-neutral-200 dark:border-neutral-700">
        <time datetime={post.data.date.toISOString()}>
          {formatDate(post.data.date)}
        </time>
        <span>•</span>
        <span>By {post.data.author}</span>
        {post.data?.assistant && (
          <>
            <span>•</span>
            <span>Assisted by {post.data.assistant}</span>
          </>
        )}
      </div>
    </header>

    <div class="prose mx-auto">
      <Content />
    </div>
  </article>
</BaseLayout>
